{% extends "app/base.html" %}
{% load widget_tweaks %}

{% block content %}

<div>
    <h2 class="ttl-bd mt-4 mb-4">投稿入力</h2>
</div>

<form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <div class="formpost">
        {% render_field form.title class="form-control" placeholder="タイトル" %}
    </div>
    <div class="formpost">
        {% render_field form.area class="form-control" placeholder="エリアを選択" %}
    </div>
    <div class="formpost">
        {% render_field form.attraction class="form-control" placeholder="アトラクションを選択" %}
    </div>
    <div class="formpost">
        {% render_field form.category class="form-control" placeholder="記事カテゴリを選択" %}
    </div>
    <div class="formpost">
        {{ form.image }}
    </div>
    <div class="formpost">
        {% render_field form.content class="form-control" placeholder="本文を入力（10,000文字）" %}
    </div>
    <div class="text-center">
        <button class="btn btn-info" type="submit">投稿確認画面へ進む</button>
    </div>
</form>

{% endblock %}

{% block extra_js %}
<script>
    const areaElement = $('#id_area');
    const attractionElement = $('#id_attraction');
    const area_attraction = {
        'ファンタジーランド': [
            {
                'value': 'アリスのティーパーティー',
                'name': 'アリスのティーパーティー'
            },
            {
                'value': 'イッツ・ア・スモールワールド',
                'name': 'イッツ・ア・スモールワールド'
            },
            {
                'value': 'キャッスルカルーセル',
                'name': 'キャッスルカルーセル'
            },
            {
                'value': '白雪姫と七人のこびと',
                'name': '白雪姫と七人のこびと'
            },
            {
                'value': 'シンデレラのフェアリーテイル・ホール',
                'name': 'シンデレラのフェアリーテイル・ホール'
            },
        ],
        'トゥーンタウン': [
            {
                'value': 'ガジェットのゴーコースター',
                'name': 'ガジェットのゴーコースター'
            },
        ],
    };
    const changeArea = (select) => {
        attractionElement.children().remove();
        const parentId = areaElement.val();
        const categoryList = area_attraction[parentId];
        for (const category of categoryList) {
            const option = $('<option>');
            option.val(category['value']);
            option.text(category['name']);
            attractionElement.append(option);
        }
        if (select !== undefined) {
            attractionElement.val(select);
        }
    };
    $('#id_area').on('change', () => {
        changeArea();
    });
    if (areaElement.val()) {
        const selectedCategory = attractionElement.val();
        changeArea(selectedCategory);
    }
</script>
{% endblock %}